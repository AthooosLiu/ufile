# 解压缩服务

解压缩服务是UCloud对外提供的低成本高可靠的解压服务，用户通过在控制台的存储桶设置解压缩规则，设置触发前缀，解压后的目标bucket及目标路径，实现在规则前缀下上传的*.zip文件进行自动解压。



## 配置解压缩规则

### 创建规则

- 1.[登录控制台](https://console.ucloud.cn/ufile/ufile)
- 2.点击打开目标bucket功能详情，点击【数据处理】或【文件管理】
- 3.在ZIP包解压列表点击【添加规则】
- 4.填写相关参数，确认创建规则
![image](/images/zip/创建规则.png)
![image](/images/zip/规则.png)

#### 参数介绍


| 参数     | 是否必选      | 说明  |
| ------  | ---------               | -------------------------------------------------------|
| 触发前缀  | 是                     |  解压触发前缀设置，在该前缀目录下上传的*.zip文件均会自动触发解压，规则的前缀之间不能存在互相包含的关系，如果已经存在规则，则不能选择全部文件作为触发条件，若已经有规则的触发条件是全部文件，则不能创建其他规则，目录格式a/b/   |
| 源bucket令牌  | 是       | bucket令牌需要具有上传下载权限，若令牌权限设置了prefix，则该prefix应该包含触发前缀，否则会解压失败                                                 |
| 目标bucket    | 是       | 选择解压后文件需要上传的bucket，可以和源bucket相同，也可以不相同|
| 目标bucket令牌 | 是    | bucket令牌需要具有上传下载权限，若令牌权限设置了prefix，则该prefix应该包含目标目录，否则会解压失败                                                 |
| 目标路径 | 否    | 解压后上传的目标路径，不传默认解压到上传的*.zip的key目录，上传到根目录输入"/"，其他目录格式"a/b/c"                      |
| 解压配置 | 是    |解压后的目录是否保留文件名为最后一层目录，目标目录为a/，压缩文件名为b.zip，若选择保留，则解压后文件路径为a/b/，若选择不保留，则解压后的文件路径为a/ |
| 规则名字 | 是    | 解压缩规则名字 |


#### 配置用例:

- 上传到src前缀下，解压到dst目录，不保留压缩文件名为目录 ,前缀设置为src/,目标目录设置为dst/
- 解压后的文件结构
![image](/images/zip/用例一.png)

- 上传到src前缀下，解压到dst目录，保留压缩文件名为目录 ,前缀设置为src/,目标目录设置为dst/
- 解压后的文件结构
![image](/images/zip/用例二.png)
- 上传到src前缀下，解压到dst目录，保留压缩文件名为目录 ,前缀设置为src/,目标目录设置为空，默认解压到上传的*.zip文件的key目录下
- 解压后的文件结构
![image](/images/zip/用例三.png)

## 修改规则
选择US3指定存储空间，在右侧操作中点击数据处理按钮，会展示所有的该存储空间的解压缩规则，选择想要修改的规则即可
![image](/images/zip/修改规则.png)
点击修改以后，会弹出修改窗口，修改想要修改对应窗口里面的字段即可
![image](/images/zip/修改规则-弹窗.png)

## 删除规则
对于不需要的zip包解压规则，您可以手动删除,选择US3指定存储空间，点击数据处理按钮，选择想要删除的规则，删除过后，该规则不会在自动触发解压
![image](/images/zip/删除规则.png)
依据弹窗的提示选择确定删除或者取消操作
![image](/images/zip/删除规则-弹窗.png)


## 注意事项
- 目前解压缩处于公测阶段，目前只支持上海地域，仅仅支持后缀zip包文件的解压
- 每个bucket最多只能够创建十条解压缩规则
- 每个规则的筛选前缀之间不能互相包含，例如：有个规则的筛选前缀为 /a/b/c/d,则不能再创建/a/b/c和/a/b/c/d/e的规则前缀
- 目标目录默认不填，会自动解压到你上传的的key的前缀作为目录
- 源bucket令牌的权限要具备上传下载权限，如果令牌设置了prefix，则不能和自己规则的筛选前缀有冲突关系，否则会解压失败
- 目标bucket令牌的权限要具备上传下载权限，如果令牌设置了prefix，则不能目标目录有冲突关系，否则会解压失败
- 注意目标目录的设置和筛选前缀的设置，解压后若还存在zip文件，可能还会触发解压行为
- 创建规则包含两个入口，一个是存储桶的bucket文件管理的创建规则，另一个是数据处理下面的创建规则
- 解压缩目前处于公测阶段，后续会按照使用次数，资源使用以及请求流量三个维度进行收费
