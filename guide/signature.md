
{{indexmenu_n>7}}

# 签名

### UFile请求流程

对UFile的HTTP请求可以根据是否携带身份验证信息分为匿名请求和带身份验证的请求。匿名请求指的是请求中没有携带任何和身份相关的信息；带身份验证的请求指的是按照 UFile API 文档中规定的在请求头部或者在请求 URL 中携带签名的相关信息。

匿名请求流程

- 用户的请求被发送到UFile的HTTP服务器上。

- UFile根据URL解析出Bucket和Object。

- UFile检查Object是否设置了ACL。

- 如果没有设置ACL，那么继续4。

- 如果设置了ACL，则判断Object的ACL是否允许匿名用户访问。

- 允许则跳到5。

- 不允许则拒绝请求，请求结束。

- UFile判断Bucket的ACL是否允许匿名用户访问。

- 允许则继续5。

- 不允许则返回，请求结束。

- 权限验证通过，返回Object的内容给用户。

带身份验证的请求流程

- 用户的请求被发送到UFile的HTTP服务器上。

- UFile根据URL解析出Bucket和Object。

- UFile根据请求的UFile的AccessKeyId获取请求者的相关身份信息，进行身份鉴权。

- 如果未获取成功，则返回，请求结束。

- 如果获取成功，但请求者不被允许访问此资源，则返回，请求结束。

- 如果获取成功，但UFile端根据请求的HTTP参数计算的签名和请求发送的签名字符串不匹配，则返回，请求结束。

- 如果身份鉴权成功，那么继续4。

- UFile检查Object是否设置了ACL。

- 如果Object没有设置ACL，那么继续5。

- 如果Object设置了ACL，UFile判断Object的ACL是否允许此用户访问。

- 允许则跳到6。

- 不允许则拒绝请求，请求结束。

- UFile判断Bucket的ACL是否允许此用户访问。

- 允许则继续6。

- 不允许则返回，请求结束。

- 权限验证通过，返回Object的内容给用户。

身份验证类型

目前访问 UFile 使用的身份验证有两种类型，具体如下：

1. UCloud账号 API密钥


UCloud账号 API密钥特指 Bucket 拥有者的 API 密钥（公私钥），每个UCloud账号提供的 API密钥对拥有的资源有完全的权限。每个UCloud账号仅有一个API 密钥。

> 注意 请避免直接使用UCloud账号的API 密钥。

2. Token 令牌

Token 令牌是UCloud提供的资源访问控制服务。Token 令牌指的是UCloud账号设置的用于访问Bucket资源的授权令牌。通过 Token，您可以集中管理您的用户（比如员工、系统或应用程序），以及控制用户可以访问您名下哪些资源的权限。比如能够限制您的用户只拥有对某一个 Bucket 的读权限。

身份验证具体实现

目前主要有两种身份验证方式：

- API密钥 验证

- Token 令牌验证

当用户以个人身份向 UFile 发送请求时，其身份验证的实现如下：

- 用户将发送的请求按照UFile指定的格式生成签名字符串。

- 用户使用API密钥中的私钥对签名字符串进行加密产生验证码。

- UFile 收到请求以后，通过API密钥中的公钥找到对应的私钥，以同样的方法提取签名字符串和验证码。

- 如果计算出来的验证码和提供的一样即认为该请求是有效的。

- 否则，UFile 将拒绝处理这次请求，并返回 HTTP 403错误。

带身份验证访问UFile的三种方法

- 使用控制台访问UFile：控制台中对用户隐藏了身份验证的细节，使用控制台访问UFile的用户无需关注细节。更多信息请参见[*下载文件*](#_下载文件_1)。

- 使用SDK访问UFile：UFile提供了多种开发语言的SDK，SDK中实现了签名算法，只需要将API密钥中的私钥信息作为参数输入即可。详情请参见各语言SDK文档中的访问控制章节。

- 使用API访问UFile：如果您想用自己喜欢的语言来封装调用RESTful API接口，您需要实现签名算法来计算签名。

### 在Header中包含签名

## 权限控制

UFile的权限控制分两种配置：

1.  对Bucket设置公共访问和私有访问类型；

2.  给Bucket配置Token令牌来管理对Bucket的访问权限；

### 配置存储空间Bucket的类型

存储空间类型分私有空间和公有空间两种：

| 类型     | 解释 |
| -------- | --------------------------------------------------------------------------------------------- |
| 私有空间 | 只有该存储空间的拥有者可以对该存储空间内的文件进行读写操作，其他人无法访问该存储空间内的文件。|
| 公共空间 | 只有该存储空间的拥有者可以对该存储空间内的文件进行写操作，任何人（包括匿名访问者）可以对该存储空间中的文件进行读操作。|

存储空间的类型可以在创建时选择，也可以在创建后进行设置。

在创建后更改空间类型的操作步骤如下：

1. 进入[* UFile 管理控制台*](https://console.ucloud.cn/ufile/ufile)界面。

2. 在左侧存储空间列表中，单击目标存储空间行域名管理右侧的…按钮，在弹出的下来菜单里面选择修改空间类型。

![](images/image15.jpg)

3. 在弹出的修改空间类型窗口里面修改空间类型。

![](images/image16.jpg)

